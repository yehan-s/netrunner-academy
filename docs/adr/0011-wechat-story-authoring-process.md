# ADR 0011：WeChat 剧情模式创作流程收敛

## 状态

Accepted（已采纳）

## 背景

前期为 WeChat 剧情模式实现了长流程微信群聊与 Story 关卡联动，但创作流程相对散乱：
- 有时先写关卡再“补剧情”；
- 有的剧情只是简单把已有 case_XX 串起来，缺乏真实事故故事线与教学节奏；
- 对“剧情复杂度”“环环相扣”的要求没有显式文档化，后续贡献者难以保持统一标准。

为保证剧情模式真正承担“从真实事故还原到工具练习”的教学职责，需要对创作流程做硬性约束。

## 决策

- 将 WeChat 剧情模式的创作流程固定为三步：
  1. **先写 Lesson**：在 `docs/lessons/` 下基于最新官方文档和真实事故整理教学文档；
  2. **再写剧情草案**：在 `storylines.ts` 中设计完整微信聊天故事线（至少 10 条消息，允许群聊+私聊+闲聊），并在评审通过前禁止实现任何新 Story 关卡；
  3. **最后实现 Story 关卡 + 测试**：在 `constants.ts` / `VirtualBrowser` / `networkEngine` 中按剧情一一对齐实现 `story_XX_*` 关卡，并为每条 Story 关卡与至少一条剧情链路编写 Playwright E2E。
- 为剧情创作新增专门的教学文档 `docs/lessons/wechat-story-authoring.md`，明确：
  - 剧情必须来自真实生产事故改编，禁止凭空杜撰；
  - 剧情模式是“环环相扣的长流程”而不是独立题目列表；
  - Story 关卡的难度和复杂度必须明显高于普通 `case_XX` 单关，且至少覆盖两类以上工具/知识点（如 CDN + 抓包 + JS 逆向）。
- 所有后续 WeChat 剧情相关改动，必须先在 Tasks 文档中登记并评审通过，再允许进入编码阶段。

## 影响

- 任何试图“先写关卡再补剧情”的修改会被流程明确拒绝，降低剧情与关卡脱节的风险。
- 新增贡献者可以直接参照 `wechat-story-authoring.md` 按步骤操作，避免引入与现有剧情风格、难度差异过大的内容。
- 通过强制 E2E 测试覆盖“剧情 → Story 关卡 → 回剧情”的链路，可以在重构或新增关卡时及时发现对剧情模式的破坏。