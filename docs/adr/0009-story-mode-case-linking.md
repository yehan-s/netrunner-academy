# ADR 0009：微信剧情模式与训练关卡联动设计（初版）

## 状态

Superseded by ADR 0010（已被独立 Story 关卡方案取代）

## 背景

ADR 0008 已经实现独立的微信剧情模式与本地进度存储，但当前剧情只起到“叙事”作用，没有直接驱动具体操作关卡。用户希望每一个剧情中的“任务节点”都能跳转到一个可交互的训练关卡，形成“看微信 → 接任务 → 进关卡实操”的完整闭环。

由于当前模拟环境中已经存在一批质量较高、贴近真实工具行为的训练关卡（`case_01` ~ `case_34`），在本阶段我们**最初**选择先复用这些关卡承载剧情任务，后续如有需要再为剧情模式设计完全独立的 `story_*` 关卡。

在 ADR 0010 中，我们已经正式采纳“独立 Story 关卡”方案：微信剧情中的任务节点将跳转到 `story_01_*` 系列关卡，而不是直接使用 `case_01`~`case_04`，但本 ADR 仍保留用于追踪设计演进历史。

## 决策

- 扩展 `StoryMessage` 结构，引入可选字段 `targetCaseId`，用于标记某条剧情消息对应的训练关卡 ID。
- 在微信剧情界面中，当当前剧情解锁到带有 `targetCaseId` 的消息时，显示“进入任务”按钮，点击后自动切换到游戏主界面并加载对应关卡。
- 为了降低实现复杂度与避免重复造轮子，当前阶段将 `targetCaseId` 映射到既有训练关卡（如登录 500 → `case_01`，价格篡改 → `case_02` 等），但在 ADR 中明确这一点，便于后续演进为独立剧情专用关卡。

## 影响

- 玩家在微信剧情中读到某个事故场景时，可以一键跳转到对应的训练关卡进行实际操作，剧情与教程形成流水线。
- 当前实现不会新增新的 CaseStudy/VirtualBrowser 页面，仅在剧情层对既有关卡做编排；未来如需“完全不复用”，可以新增 story 系列关卡并更新 `targetCaseId` 映射。
