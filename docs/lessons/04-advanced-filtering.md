# 第四课：高级过滤与搜索技巧

## 为什么需要高级过滤？

**现实场景**：

```
打开一个电商网站首页 → Reqable 捕获了 300+ 个请求
├── 150 个图片资源
├── 80 个 JS/CSS 文件
├── 50 个广告追踪请求
└── 20 个真正的 API 请求 ← 你只关心这些！
```

**痛点**：在海量流量中找到关键请求就像大海捞针。

**解决方案**：掌握高级过滤技巧，1 秒内定位目标！

---

## 过滤器类型详解

### 1. 内容类型过滤（快速筛选）

#### 常用过滤器

```
All      - 显示所有请求（默认）
Http     - 仅 HTTP（明文传输）
Https    - 仅 HTTPS（加密传输）
JSON     - 仅 JSON 响应（API 调试必备）
XML      - 仅 XML 响应（SOAP/RSS）
HTML     - 仅 HTML 页面（网页爬虫）
图片     - 仅图片资源（.jpg/.png/.webp）
媒体     - 仅音视频（.mp4/.m4a）
```

#### 实战案例：调试登录接口

**场景**：网站登录失败，需要找到登录请求。

**步骤**：

1. 点击过滤器 → 选择 **JSON**（登录接口通常返回 JSON）
2. 在搜索框输入 `login`
3. 找到 `POST /api/login` 请求
4. 查看响应体：`{"error": "密码错误"}`

**效率提升**：从 300 个请求缩小到 5 个！

---

### 2. 搜索功能（精准定位）

#### 搜索范围

Reqable 的搜索框会匹配：

- **URL 路径**: `login` 匹配 `/api/login`、`/user/login`
- **域名**: `api.example.com` 匹配该域名的所有请求
- **HTTP 方法**: `POST` 匹配所有 POST 请求
- **状态码**: `404` 匹配所有 404 错误

#### 实战技巧

**技巧 1：组合过滤器 + 搜索**

```
过滤器选择 "JSON" + 搜索框输入 "user"
→ 只显示包含 "user" 的 JSON 请求
```

**技巧 2：搜索域名**

```
搜索框输入: api.example.com
→ 隔离特定域名的请求，排除 CDN/广告
```

**技巧 3：搜索状态码**

```
搜索框输入: 500
→ 快速找到所有服务器错误
```

**技巧 4：搜索请求方法**

```
搜索框输入: DELETE
→ 找到所有删除操作
```

---

### 3. 高级过滤组合

#### 案例 1：只看失败的 API 请求

**目标**：找出所有返回 4xx/5xx 错误的 JSON 请求。

**操作**：

1. 过滤器选择 **JSON**
2. 搜索框依次输入 `400`、`401`、`404`、`500`...

**更高效方法**（如果 Reqable 支持正则）：

```
搜索框输入: (4|5)\d{2}
→ 匹配所有 400-599 状态码
```

#### 案例 2：分析特定功能模块

**目标**：只看用户相关的请求（登录、注册、个人资料）。

**操作**：

```
搜索框输入: user
→ 匹配 /api/user/login, /api/user/profile, /api/user/register
```

#### 案例 3：性能分析 - 找出慢请求

**目标**：找出耗时超过 2 秒的请求。

**操作**：

1. 在请求列表中点击 **Time（耗时）** 列排序
2. 降序排列，耗时最长的请求在最上面

---

## 高级搜索技巧

### 1. 使用正则表达式（如果支持）

#### 示例 1：匹配所有 API 版本

```regex
/api/v\d+/
→ 匹配 /api/v1/users, /api/v2/posts, /api/v3/orders
```

#### 示例 2：匹配所有图片格式

```regex
\.(jpg|jpeg|png|webp|gif)$
→ 匹配所有图片文件
```

#### 示例 3：匹配特定参数

```regex
\?.*page=\d+
→ 匹配所有带 page 参数的分页请求
```

---

### 2. URL 模式匹配

#### 通配符使用

```
*.example.com       - 匹配所有子域名
api.example.com/*   - 匹配该域名下所有路径
*/login             - 匹配所有以 /login 结尾的路径
```

#### 实战案例：排除静态资源

**场景**：只看动态 API 请求，排除 JS/CSS/图片。

**方法 1（白名单）**：

```
过滤器: JSON/XML
```

**方法 2（黑名单，如果支持排除规则）**：

```
排除: *.js, *.css, *.png, *.jpg
```

---

## 保存常用过滤器（推荐工作流）

### 创建过滤器预设

如果 Reqable 支持保存过滤器（类似 Chrome DevTools 的自定义过滤器），可以创建：

**预设 1：API 调试**

```yaml
名称: API Debug
规则:
  - 仅 JSON/XML
  - 排除图片/媒体/JS/CSS
  - 仅显示 4xx/5xx 错误
```

**预设 2：性能分析**

```yaml
名称: Performance
规则:
  - 按耗时降序排列
  - 高亮耗时 >1s 的请求
```

**预设 3：安全测试**

```yaml
名称: Security
规则:
  - 仅 POST/PUT/DELETE 请求
  - 高亮包含 password/token 的请求
```

---

## 实战练习

### 练习 1：找出所有失败的登录尝试

**目标**：找到所有返回 401（未授权）的 `/login` 请求。

**步骤**：

1. 过滤器选择 **JSON**
2. 搜索框输入 `login`
3. 点击 **Status（状态码）** 列排序
4. 找到所有 `401 Unauthorized` 的请求
5. 查看请求体，分析是用户名错误还是密码错误

**验证**：

- 正确的登录请求应该返回 `200 OK` + Token
- 错误的登录请求返回 `401` + 错误信息

### 练习 2：分析分页加载流程

**目标**：找到商品列表的分页请求，观察参数变化。

**步骤**：

1. 访问电商网站的商品列表页
2. 搜索框输入 `page=`
3. 滚动页面加载第 2 页、第 3 页
4. 对比请求：
   ```
   GET /api/products?page=1&size=20
   GET /api/products?page=2&size=20
   GET /api/products?page=3&size=20
   ```

**分析**：

- 参数 `page` 如何变化？
- 是否有 `total`（总数）字段？
- 响应体是否包含分页元信息？

### 练习 3：识别 AJAX vs 页面跳转

**目标**：区分前端 AJAX 请求和传统表单提交。

**操作**：

1. 过滤器选择 **JSON**（AJAX 通常返回 JSON）
2. 过滤器选择 **HTML**（页面跳转返回 HTML）
3. 对比两种登录方式：
   - AJAX 登录: `POST /api/login` → `200 OK` + JSON
   - 表单登录: `POST /login` → `302 Found` + 重定向到首页

---

## 常见问题

### Q: 搜索框支持正则表达式吗？

**A**: Reqable 的搜索框默认是**字符串匹配**，不支持正则。但你可以：

- 使用通配符（如果支持）
- 利用"包含"逻辑组合多个关键词
- 使用外部工具（如 `grep`）处理导出的 HAR 文件

### Q: 如何排除某些域名？

**A**: 当前 Reqable 没有直接的"排除"功能，解决方案：

1. **方法 1（白名单）**: 搜索框输入目标域名，只看该域名
2. **方法 2（手动过滤）**: 使用过滤器 + 搜索组合，缩小范围

### Q: 如何保存过滤规则？

**A**: Reqable 支持"**我的收藏**"功能：

1. 右键目标请求 → **添加到收藏**
2. 在"我的收藏"标签页中管理常用请求

### Q: 大量请求时 Reqable 变慢怎么办？

**A**: 优化方案：

1. **及时停止抓包**: 抓到目标请求后点"停止"
2. **清空列表**: 点击垃圾桶图标清空无关请求
3. **使用过滤器**: 减少显示的请求数量
4. **限制抓包范围**: 在代理设置中排除不需要的域名

---

## 进阶技巧

### 1. 使用 HAR 文件进行离线分析

**导出流程**：

1. 抓包完成后，点击"导出"→ 选择 **HAR 格式**
2. 使用 Chrome DevTools 或 HAR Viewer 离线分析

**优势**：

- 可以分享给团队成员
- 支持版本控制（Git 管理）
- 可以用脚本批量分析

### 2. 结合浏览器 DevTools

**组合使用**：

```
Reqable（抓包）+ Chrome DevTools（调试）
├── Reqable 看请求/响应原始数据
└── DevTools 看 JS 代码执行流程
```

**案例**：调试 AJAX 请求失败

1. 在 DevTools Console 看到错误：`Uncaught TypeError: Cannot read property 'data' of undefined`
2. 在 Reqable 中找到对应的 AJAX 请求
3. 发现响应体是 `{"error": "..."}`，而不是预期的 `{"data": {...}}`
4. 修复前端代码，增加错误处理

---

## 小结

✅ 你已经掌握：

- 内容类型过滤器的使用
- 搜索框的高级技巧
- 过滤器 + 搜索的组合使用
- 正则表达式模式匹配
- 常见问题的解决方案

下一课：

- 📘 [第五课：流量拦截与修改（断点功能）](./05-breakpoint-and-modification.md)
- 📘 [第六课：HTTPS 证书配置](./06-https-certificate-setup.md)

---

## 延伸阅读

- [Reqable 过滤器文档](https://reqable.com/docs/filter)
- [HAR 文件格式规范](http://www.softwareishard.com/blog/har-12-spec/)
- [Chrome DevTools Network 面板](https://developer.chrome.com/docs/devtools/network)
