# 第一课：抓包基础概念

## 什么是抓包？

**抓包（Packet Capture）** 是指捕获网络中传输的数据包，并对其进行分析的技术。在应用层抓包主要关注 **HTTP/HTTPS 请求和响应**。

### 为什么需要抓包？

1. **调试 API 接口** - 查看前端发送的请求参数是否正确
2. **分析网络问题** - 定位请求失败的原因（404、500 等）
3. **逆向工程** - 研究 App/网站的通信协议
4. **安全测试** - 发现接口的安全漏洞
5. **性能优化** - 分析请求耗时，找出性能瓶颈

---

## 抓包工具的工作原理

### 代理模式（Proxy Mode）

大多数抓包工具（如 Reqable、Charles、Fiddler）都使用 **HTTP 代理** 工作：

```
客户端（浏览器/App）
    ↓ 发送请求
代理工具（Reqable）← 拦截并记录
    ↓ 转发请求
目标服务器
    ↓ 返回响应
代理工具 ← 拦截并记录
    ↓ 转发响应
客户端
```

**关键步骤：**
1. 设置系统代理：`127.0.0.1:8888`（Reqable 默认端口）
2. 所有网络请求会经过代理工具
3. 工具记录请求/响应后转发

---

## HTTP vs HTTPS

### HTTP（明文传输）
- ✅ 可以直接抓包，无需配置
- ❌ 不安全，数据可被窃听

### HTTPS（加密传输）
- ✅ 安全，数据被 TLS/SSL 加密
- ⚠️ 需要安装证书才能抓包

**为什么 HTTPS 需要证书？**

```
客户端 ←→ [TLS 加密] ←→ 服务器
```

抓包工具需要"解密"流量才能查看内容：

```
客户端 ←→ [伪证书] ←→ Reqable ←→ [真证书] ←→ 服务器
        (客户端信任)              (服务器信任)
```

**中间人攻击（MITM）原理** - 合法使用：
- 抓包工具生成一个伪造的证书
- 客户端信任这个证书（需要手动安装）
- 工具解密客户端流量，再用真证书连接服务器

---

## 关键概念

### 1. 请求（Request）

客户端发送给服务器的数据，包含：

- **Method（方法）**: GET、POST、PUT、DELETE 等
- **URL（地址）**: `https://api.example.com/users/123`
- **Headers（请求头）**:
  ```
  Content-Type: application/json
  Authorization: Bearer token123
  ```
- **Body（请求体）**: POST/PUT 时携带的数据

### 2. 响应（Response）

服务器返回给客户端的数据，包含：

- **Status Code（状态码）**:
  - `200` - 成功
  - `404` - 未找到
  - `500` - 服务器错误
- **Headers（响应头）**:
  ```
  Content-Type: application/json
  Set-Cookie: session_id=abc123
  ```
- **Body（响应体）**: 返回的数据（JSON、HTML 等）

### 3. 协议版本

- **HTTP/1.1** - 最常见，每个请求独立连接
- **HTTP/2** - 多路复用，一个连接处理多个请求
- **WebSocket** - 双向通信，用于实时数据

---

## 实战练习

### 任务 1：识别请求方法

观察以下场景，判断应该使用什么 HTTP 方法：

1. 打开网页首页 → **GET**
2. 提交登录表单 → **POST**
3. 修改用户资料 → **PUT** 或 **PATCH**
4. 删除一条评论 → **DELETE**

### 任务 2：分析状态码

遇到以下状态码时，分别代表什么？

- `200` - ✅ 请求成功
- `301` - 🔀 永久重定向
- `401` - 🔐 未授权（需要登录）
- `403` - 🚫 禁止访问（权限不足）
- `404` - ❓ 资源不存在
- `500` - 💥 服务器内部错误
- `502` - 🔌 网关错误（后端服务挂了）
- `503` - ⏸️ 服务不可用（维护中）

---

## 常见误区

### ❌ "抓包能看到所有网络流量"
**真相**: 只能看到走代理的 HTTP(S) 流量，TCP/UDP 裸数据包需要用 Wireshark

### ❌ "HTTPS 无法抓包"
**真相**: 安装证书后可以抓，但部分 App 会做证书绑定（Certificate Pinning）防止抓包

### ❌ "抓包工具会泄露我的密码"
**真相**: 如果连接了恶意代理服务器会泄露，但本地抓包工具（127.0.0.1）是安全的

---

## 下一步

✅ 你已经了解抓包的基本概念

接下来学习：
- 📘 [第二课：Reqable 快速入门](./02-reqable-quick-start.md)
- 📘 [第三课：HTTP 协议深度分析](./03-http-protocol-analysis.md)

---

## 延伸阅读

- [HTTP 协议规范（RFC 7230-7235）](https://tools.ietf.org/html/rfc7230)
- [TLS/SSL 工作原理](https://en.wikipedia.org/wiki/Transport_Layer_Security)
- [抓包工具对比：Charles vs Fiddler vs Reqable](https://reqable.com/docs)
